{% extends "base.html" %}
{% load humanize %}

{% block title %}Uncle Machine Shop - {{ category.name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 lg:px-8 py-8">

    <!-- Breadcrumb -->
    <div class="mb-8">
        <nav class="flex items-center space-x-2 text-sm text-gray-600">
            <a href="{% url 'index' %}" class="hover:text-black transition">
                <i class="fas fa-home"></i>
            </a>
            <span>/</span>
            <a href="{% url 'categories' %}" class="hover:text-black transition">หมวดหมู่</a>
            <span>/</span>
            <span class="text-black font-medium">{{ category.name }}</span>
        </nav>
    </div>

    <!-- Category Header -->
    <div class="mb-12 bg-gradient-to-r from-gray-900 to-black rounded-3xl p-8 lg:p-12 text-white">
        <div class="flex items-center mb-4">
            <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center mr-4">
                <i class="fas fa-cog text-3xl text-black"></i>
            </div>
            <div>
                <h1 class="text-4xl lg:text-5xl font-bold mb-2">{{ category.name }}</h1>
                <p class="text-gray-300">
                    <i class="fas fa-cog mr-2"></i>
                    มี {{ machine_count }} เครื่อง
                </p>
            </div>
        </div>

        {% if category.description %}
        <p class="text-xl text-gray-200 mt-4">
            {{ category.description }}
        </p>
        {% endif %}
    </div>

    <!-- Books Grid -->
    {% if machines %}
    <div class="mb-8">
        <h2 class="text-2xl font-bold mb-6">เครื่องจักรในหมวดหมู่นี้</h2>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        {% for machine in machines %}
        <div class="book-card bg-white rounded-2xl overflow-hidden cursor-pointer group transition-all hover:shadow-2xl">
            <!-- Book Cover -->
            <div class="bg-gray-200 relative overflow-hidden">
                {% if machine.cover_image %}
                <img src="{{ machine.cover_image.url }}"
                     alt="{{ machine.title }}"
                     class="w-full h-94 object-cover group-hover:scale-110 transition-transform duration-500"
                     onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\'w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200\'><i class=\'fas fa-cog text-6xl text-gray-400\'></i></div>';">
                {% else %}
                <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
                    <i class="fas fa-cog text-6xl text-gray-400"></i>
                </div>
                {% endif %}

                <!-- Availability Badge -->
                {% if machine.is_available %}
                <div class="absolute top-3 right-3 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full">
                    พร้อมดู
                </div>
                {% endif %}

                <!-- Hover Overlay -->
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-all duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
                    <a href="{% url 'machine_detail' machine.slug %}" class="bg-white text-black px-6 py-3 rounded-full font-semibold transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
                        <i class="fas fa-eye mr-2"></i>ดูรายละเอียด
                    </a>
                </div>
            </div>

            <!-- Book Info -->
            <div class="p-4">
                <h3 class="font-bold text-base mb-2 line-clamp-2 group-hover:text-gray-600 transition min-h-[3rem]">
                    {{ machine.title }}
                </h3>

                {% if machine.descriptions %}
                <p class="text-sm text-gray-600 mb-3 line-clamp-2">
                    {{ machine.descriptions|truncatewords:10 }}
                </p>
                {% endif %}

                <div class="flex items-center justify-between mt-auto mb-3">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-cog text-gray-400 text-sm"></i>
                        <span class="text-sm text-gray-600">{{ machine.category.name|default:"เครื่องจักรทั่วไป" }}</span>
                    </div>
                    <div class="font-bold text-indigo-600">฿{{ machine.price|intcomma }}</div>
                </div>

                <form action="{% url 'cart_add' machine.id %}" method="post" class="relative z-20">
                    {% csrf_token %}
                    <input type="hidden" name="quantity" value="1">
                    <button type="submit" class="w-full bg-gray-900 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-black transition flex items-center justify-center">
                        <i class="fas fa-cart-plus mr-2"></i>ใส่ตะกร้า
                    </button>
                </form>

                <!-- Additional Images Indicator -->
                {% if machine.covers_images.count > 0 %}
                <div class="mt-3 flex items-center text-xs text-gray-500">
                    <i class="fas fa-images mr-1"></i>
                    <span>+{{ machine.covers_images.count }} รูปภาพ</span>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- No Books Found -->
    <div class="text-center py-20">
        <div class="inline-flex items-center justify-center w-24 h-24 bg-gray-100 rounded-full mb-6">
            <i class="fas fa-cog text-4xl text-gray-400"></i>
        </div>
        <h3 class="text-2xl font-bold mb-2">ยังไม่มีเครื่องจักรในหมวดหมู่นี้</h3>
        <p class="text-gray-600 mb-6">กำลังเพิ่มเครื่องจักรใหม่ๆ เร็วๆ นี้</p>
        <a href="{% url 'categories' %}" class="inline-flex items-center bg-black text-white px-8 py-3 rounded-full font-semibold hover:bg-gray-800 transition">
            <i class="fas fa-arrow-left mr-2"></i>
            กลับไปดูหมวดหมู่อื่น
        </a>
    </div>
    {% endif %}

    <!-- Back to Categories -->
    <div class="text-center mt-12 flex justify-center space-x-4">
        <a href="{% url 'categories' %}" class="inline-flex items-center justify-center px-8 py-3 bg-gray-100 text-black rounded-full hover:bg-gray-200 transition-all duration-300">
            <i class="fas fa-arrow-left mr-2"></i>
            กลับไปดูหมวดหมู่
        </a>
        <a href="{% url 'machines' %}" class="inline-flex items-center justify-center px-8 py-3 bg-black text-white rounded-full hover:bg-gray-800 transition-all duration-300">
            <i class="fas fa-cog mr-2"></i>
            ดูเครื่องจักรทั้งหมด
        </a>
    </div>
</div>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .book-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .book-card:hover {
        transform: translateY(-8px);
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .book-card {
        animation: fadeIn 0.5s ease-out;
    }

    /* Stagger animation for cards */
    .book-card:nth-child(1) { animation-delay: 0.05s; }
    .book-card:nth-child(2) { animation-delay: 0.1s; }
    .book-card:nth-child(3) { animation-delay: 0.15s; }
    .book-card:nth-child(4) { animation-delay: 0.2s; }
    .book-card:nth-child(5) { animation-delay: 0.25s; }
</style>
{% endblock %}
